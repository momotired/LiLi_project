# 价格模块 API

## 概述
管理设备价格跟踪，包括实时价格获取、价格历史记录、价格预测、价格预警等功能。

## 接口列表

### 1. 获取设备价格信息

**接口描述:** 获取设备的当前价格信息

**请求方式:** `GET`

**请求路径:** `/prices/device/{device_id}`

**是否需要认证:** 是

**请求参数:**
- `device_id`: int, 设备ID, 路径参数, 必填

**业务逻辑:**
1. 验证设备归属权
2. 获取设备最新价格信息
3. 计算价格变化趋势
4. 返回当前市场价格、平均价格、价格区间

---

### 2. 获取价格历史记录

**接口描述:** 获取设备的价格历史记录

**请求方式:** `GET`

**请求路径:** `/prices/device/{device_id}/history`

**是否需要认证:** 是

**请求参数:**
- `device_id`: int, 设备ID, 路径参数, 必填
- `period`: string, 时间周期(7d/30d/90d/180d/1y), 可选, 默认30d
- `source`: string, 价格来源, 可选
- `granularity`: string, 数据粒度(day/week/month), 可选, 默认day

**业务逻辑:**
1. 验证设备归属权
2. 根据时间周期获取价格历史
3. 按数据粒度聚合数据
4. 返回价格时间序列数据

---

### 3. 获取价格趋势分析

**接口描述:** 获取设备价格趋势分析

**请求方式:** `GET`

**请求路径:** `/prices/device/{device_id}/trend`

**是否需要认证:** 是

**请求参数:**
- `device_id`: int, 设备ID, 路径参数, 必填

**业务逻辑:**
1. 验证设备归属权
2. 分析价格历史数据
3. 计算价格趋势指标
4. 返回趋势分析结果（上升/下降/平稳）

---

### 4. 获取价格预测

**接口描述:** 获取设备价格预测

**请求方式:** `GET`

**请求路径:** `/prices/device/{device_id}/prediction`

**是否需要认证:** 是

**请求参数:**
- `device_id`: int, 设备ID, 路径参数, 必填
- `period`: string, 预测周期(30d/90d/180d), 可选, 默认30d

**业务逻辑:**
1. 验证设备归属权
2. 使用历史数据进行价格预测
3. 应用简单的预测算法
4. 返回价格预测结果和置信度

---

### 5. 手动更新价格

**接口描述:** 手动更新设备价格

**请求方式:** `POST`

**请求路径:** `/prices/device/{device_id}/update`

**是否需要认证:** 是

**请求参数:**
- `device_id`: int, 设备ID, 路径参数, 必填

**业务逻辑:**
1. 验证设备归属权
2. 调用价格抓取服务
3. 更新设备价格数据
4. 返回更新结果

---

### 6. 设置价格预警

**接口描述:** 设置设备价格预警

**请求方式:** `POST`

**请求路径:** `/prices/device/{device_id}/alerts`

**是否需要认证:** 是

**请求参数:**
- `device_id`: int, 设备ID, 路径参数, 必填

```json
{
  "alert_type": "string, 预警类型(price_drop/price_rise/target_price), 必填",
  "threshold": "decimal, 预警阈值, 必填",
  "threshold_type": "string, 阈值类型(percentage/absolute), 必填",
  "enabled": "bool, 是否启用, 可选, 默认true",
  "notification_methods": "array, 通知方式(push/email), 可选"
}
```

**业务逻辑:**
1. 验证设备归属权
2. 创建价格预警规则
3. 设置预警触发条件
4. 配置通知方式

---

### 7. 获取价格预警列表

**接口描述:** 获取用户的价格预警列表

**请求方式:** `GET`

**请求路径:** `/prices/alerts`

**是否需要认证:** 是

**请求参数:**
- `status`: string, 预警状态(active/triggered/disabled), 可选
- `device_id`: int, 设备ID, 可选

**业务逻辑:**
1. 获取用户的价格预警列表
2. 按状态筛选
3. 返回预警规则和触发历史

---

### 8. 更新价格预警

**接口描述:** 更新价格预警设置

**请求方式:** `PUT`

**请求路径:** `/prices/alerts/{alert_id}`

**是否需要认证:** 是

**请求参数:**
- `alert_id`: int, 预警ID, 路径参数, 必填
- 其他参数同创建预警接口，均为可选

**业务逻辑:**
1. 验证预警归属权
2. 更新预警规则
3. 重新计算触发条件

---

### 9. 删除价格预警

**接口描述:** 删除价格预警

**请求方式:** `DELETE`

**请求路径:** `/prices/alerts/{alert_id}`

**是否需要认证:** 是

**请求参数:**
- `alert_id`: int, 预警ID, 路径参数, 必填

**业务逻辑:**
1. 验证预警归属权
2. 删除预警规则
3. 取消相关通知设置

---

### 10. 获取市场价格对比

**接口描述:** 获取设备在不同平台的价格对比

**请求方式:** `GET`

**请求路径:** `/prices/device/{device_id}/comparison`

**是否需要认证:** 是

**请求参数:**
- `device_id`: int, 设备ID, 路径参数, 必填

**业务逻辑:**
1. 验证设备归属权
2. 获取多个平台的价格信息
3. 计算价格差异
4. 返回价格对比结果

---

### 11. 获取价格数据源

**接口描述:** 获取支持的价格数据源列表

**请求方式:** `GET`

**请求路径:** `/prices/sources`

**是否需要认证:** 是

**请求参数:** 无

**业务逻辑:**
1. 获取支持的价格数据源
2. 返回数据源名称、状态、可靠性等信息

---

### 12. 批量更新价格

**接口描述:** 批量更新多个设备的价格

**请求方式:** `POST`

**请求路径:** `/prices/batch-update`

**是否需要认证:** 是

**请求参数:**
```json
{
  "device_ids": "array, 设备ID数组, 必填"
}
```

**业务逻辑:**
1. 验证设备归属权
2. 批量调用价格抓取服务
3. 更新多个设备的价格
4. 返回批量更新结果 