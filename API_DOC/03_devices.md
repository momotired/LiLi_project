# 设备模块 API

## 概述
管理用户的数码设备信息，包括设备的增删改查、设备详情、设备价值评估等核心功能。

## 接口列表

### 1. 获取设备列表

**接口描述:** 获取用户的设备列表

**请求方式:** `GET`

**请求路径:** `/devices`

**是否需要认证:** 是

**请求参数:**
- `page`: int, 页码, 可选, 默认1
- `limit`: int, 每页数量, 可选, 默认10
- `category_id`: int, 分类ID, 可选
- `status`: string, 设备状态(active/sold/broken), 可选
- `sort`: string, 排序字段(created_at/purchase_price/current_value), 可选
- `order`: string, 排序方式(asc/desc), 可选, 默认desc
- `search`: string, 搜索关键词, 可选

**业务逻辑:**
1. 根据用户身份筛选设备
2. 应用筛选条件和排序
3. 分页返回结果
4. 包含设备基本信息和当前估值

---

### 2. 获取设备详情

**接口描述:** 获取指定设备的详细信息

**请求方式:** `GET`

**请求路径:** `/devices/{device_id}`

**是否需要认证:** 是

**请求参数:**
- `device_id`: int, 设备ID, 路径参数, 必填

**业务逻辑:**
1. 验证设备归属权
2. 获取设备完整信息
3. 计算设备当前价值
4. 获取价格历史趋势
5. 返回设备规格、价值评估、价格趋势等

---

### 3. 添加设备

**接口描述:** 添加新的设备

**请求方式:** `POST`

**请求路径:** `/devices`

**是否需要认证:** 是

**请求参数:**
```json
{
  "template_id": "int, 设备模板ID, 必填",
  "name": "string, 设备名称, 必填",
  "brand": "string, 品牌, 必填",
  "model": "string, 型号, 必填",
  "category_id": "int, 分类ID, 必填",
  "purchase_price": "decimal, 购买价格, 必填",
  "purchase_date": "string, 购买日期(YYYY-MM-DD), 必填",
  "warranty_date": "string, 保修到期日期(YYYY-MM-DD), 可选",
  "serial_number": "string, 序列号, 可选",
  "color": "string, 颜色, 可选",
  "storage": "string, 存储容量, 可选",
  "memory": "string, 内存容量, 可选",
  "processor": "string, 处理器, 可选",
  "screen_size": "string, 屏幕尺寸, 可选",
  "condition": "string, 设备状态(new/good/fair/poor), 可选, 默认new",
  "notes": "string, 备注, 可选",
  "images": "array, 设备图片URL数组, 可选",
  "specifications": "json, 其他规格参数, 可选"
}
```

**业务逻辑:**
1. 验证设备模板存在性
2. 验证必填参数
3. 根据模板验证规格参数
4. 创建设备记录
5. 初始化价格跟踪
6. 设置保修提醒（如果有保修日期）

---

### 4. 更新设备

**接口描述:** 更新设备信息

**请求方式:** `PUT`

**请求路径:** `/devices/{device_id}`

**是否需要认证:** 是

**请求参数:**
- `device_id`: int, 设备ID, 路径参数, 必填
- 其他参数同添加设备接口，均为可选

**业务逻辑:**
1. 验证设备归属权
2. 更新设备信息
3. 如果保修日期变更，更新提醒设置
4. 记录修改历史

---

### 5. 删除设备

**接口描述:** 删除设备

**请求方式:** `DELETE`

**请求路径:** `/devices/{device_id}`

**是否需要认证:** 是

**请求参数:**
- `device_id`: int, 设备ID, 路径参数, 必填

**业务逻辑:**
1. 验证设备归属权
2. 软删除设备（标记为已删除）
3. 删除相关价格跟踪记录
4. 删除相关提醒设置

---

### 6. 更新设备状态

**接口描述:** 更新设备使用状态

**请求方式:** `PATCH`

**请求路径:** `/devices/{device_id}/status`

**是否需要认证:** 是

**请求参数:**
```json
{
  "status": "string, 设备状态(active/sold/broken/lost), 必填",
  "sale_price": "decimal, 出售价格, 当status为sold时必填",
  "sale_date": "string, 出售日期(YYYY-MM-DD), 当status为sold时必填",
  "notes": "string, 状态变更备注, 可选"
}
```

**业务逻辑:**
1. 验证设备归属权
2. 更新设备状态
3. 如果是出售状态，记录出售信息
4. 计算设备最终收益/损失
5. 更新设备价值统计

---

### 7. 获取设备价值评估

**接口描述:** 获取设备的价值评估信息

**请求方式:** `GET`

**请求路径:** `/devices/{device_id}/valuation`

**是否需要认证:** 是

**请求参数:**
- `device_id`: int, 设备ID, 路径参数, 必填

**业务逻辑:**
1. 验证设备归属权
2. 获取设备最新市场价格
3. 计算设备当前估值
4. 计算贬值率和持有成本
5. 返回价值评估详情

---

### 8. 批量导入设备

**接口描述:** 批量导入设备信息

**请求方式:** `POST`

**请求路径:** `/devices/import`

**是否需要认证:** 是

**请求参数:**
```json
{
  "devices": "array, 设备信息数组, 必填",
  "ignore_duplicates": "bool, 是否忽略重复设备, 可选, 默认false"
}
```

**业务逻辑:**
1. 验证批量导入数据格式
2. 检查重复设备（根据品牌、型号、序列号）
3. 批量创建设备记录
4. 返回导入结果统计

---

### 9. 获取设备图片

**接口描述:** 获取设备的图片列表

**请求方式:** `GET`

**请求路径:** `/devices/{device_id}/images`

**是否需要认证:** 是

**请求参数:**
- `device_id`: int, 设备ID, 路径参数, 必填

**业务逻辑:**
1. 验证设备归属权
2. 获取设备图片列表
3. 返回图片URL和相关信息

---

### 10. 上传设备图片

**接口描述:** 上传设备图片

**请求方式:** `POST`

**请求路径:** `/devices/{device_id}/images`

**是否需要认证:** 是

**请求参数:**
- `device_id`: int, 设备ID, 路径参数, 必填
- `images`: multipart/form-data, 图片文件, 必填

**业务逻辑:**
1. 验证设备归属权
2. 验证图片格式和大小
3. 上传图片到云存储
4. 保存图片记录
5. 返回图片URL

---

### 11. 删除设备图片

**接口描述:** 删除设备图片

**请求方式:** `DELETE`

**请求路径:** `/devices/{device_id}/images/{image_id}`

**是否需要认证:** 是

**请求参数:**
- `device_id`: int, 设备ID, 路径参数, 必填
- `image_id`: int, 图片ID, 路径参数, 必填

**业务逻辑:**
1. 验证设备归属权
2. 验证图片归属
3. 删除云存储中的图片
4. 删除图片记录 